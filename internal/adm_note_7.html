<head>
<meta http-equiv="Content-Type" content="text/html; charset=x-euc-jp">
<title>
memo about nile
</title>
</head>
<h3>
nile管理ノート(1999年12月5日〜）<br>
</h3>
<b>

最終更新：2002年3月24日（日）
</b>
<hr>
以前の nile 管理ノート(Solaris 2.6  〜 1999年9月22日 ) は<a href="./adm_note_26.html">こちら</a>。
<hr>
<ul>
<li><a href="#20020218">nile お引越</a>
<li><a href="#20020214">DNSサーバ変更</a>
<li><a href="#20011128">~g122移動準備</a>
<li><a href="#20011125">ディスクマウントせず</a>
<li><a href="#20011111">Matlab Webserver</a>
<li><a href="#20010924">メール関係の設定変更</a>
<li><a href="#20010924-2">7_Recommended patch エラー? (106950-14)</a>
<li><a href="#20010822">MATLAB6のインストール</a>
<li><a href="#20010624">DDS4 Autoloader 設置</a>
<li><a href="#20010622">sendamilパッチ（107684-02)バク？</a>
<li><a href="#20010613">fml,Python,kconvのインストール</a>
<li><a href="#20010531">www-student設定</a>
<li><a href="#20010527">sshの変更</a>
<li><a href="#20010525">二次ディスク(project3:34GB) 接続</a>
<li><a href="#20010427">mnews1.22PL5</a>
<li><a href="#20010414">UPS交換</a>
<li><a href="#20010412">PowerVisorバージョンアップ</a>
<li><a href="#20010406">IPアドレス、ネットマスク、ゲートウェイの変更</a>
<li><a href="#20010331">snmpXdmid</a>
<li><a href="#20001217">/etc/shadowの変更</a>
<li><a href="#20001215">Solaris 7 Recommended Patch Cluste</a>
<li><a href="#20001208">tcp_wrapper インストール</a>
<li><a href="#20001004">windex更新</a>
<li><a href="#20000925">特別接続開始,パスワードのエージング開始（syslog,inetd.conf変更)</a>
<li><a href="#20000715">ディスプレイ交換</a>
<li><a href="#20000610">apache設定</a>
<li><a href="#20000604">apacheインストール</a>
<li><a href="#20000514">nileの掃除</a>
<li><a href="#20000509">CPU,メモリチェック</a>
<li><a href="#20000508">ハードエラー発生</a>
<li><a href="#20000504">nakata-nx削除</a>
<li><a href="#20000324">使用延長のおしらせ</a>
<li><a href="#20000323">UPS覚書、コンソール取替え</a>
<li><a href="#19991205">makeuser変更</a>
</ul>
</ul>
<!--
/usr/lib/dmi/snmpXdmid を000にする
 http://www.securityfocus.com/bid/2417 

chinatsu@nile[198]% ls -l /usr/lib/dmi/snmpXdmid
-rwxr-xr-x   1 root     sys       213268  4月 14日  05:09 /usr/lib/dmi/snmpXdmid*
chinatsu@nile[199]% sudo chmod 000 /usr/lib/dmi/snmpXdmid
Password:
chinatsu@nile[200]% !ls
ls -l /usr/lib/dmi/snmpXdmid
----------   1 root     sys       213268  4月 14日  05:09 /usr/lib/dmi/snmpXdmid

/usr/openwin/bin/Xsunのsuid を落とす
http://www.securityfocus.com/archive/1/175490
chinatsu@nile[16]% ls -l Xsun
-rwxr-sr-x   1 root     root     1947056  2月 14日  15:02 Xsun*
chinatsu@nile[17]% sudo chmod -s /usr/openwin/bin/Xsun
chinatsu@nile[39]% ls -l Xsun
-rwxr-xr-x   1 root     root     1947056  2月 14日  15:02 Xsun*

/usr/openwin/bin/kcms_configure のsuid を落とす
http://www.securityfocus.com/archive/1/175144
chinatsu@nile[30]% ls -l kcms_configure
-rwsr-sr-x   1 root     bin        23360  8月 18日 2000年 kcms_configure*
chinatsu@nile[31]% sudo chmod -s /usr/openwin/bin/kcms_configure
chinatsu@nile[38]% ls -l kcms_configure
-rwxr-xr-x   1 root     bin        23360  8月 18日 2000年 kcms_configure*


/usr/bin/tip のsuid を落とす。
http://www.securityfocus.com/archive/1/171686
chinatsu@nile[34]% ls -l tip
-rws--x--x   1 uucp     bin        56240  8月 18日 2000年 tip*
chinatsu@nile[35]% sudo chmod -s /usr/bin/tip
chinatsu@nile[36]% ls -l tip
-rwx--x--x   1 uucp     bin        56240  8月 18日 2000年 tip*
-->
<hr>
<a name="20020218">
2002年2月18日（月）
	<ul>
	<h4>nile お引越</h4>
	学内大移動に伴い、nile も研究開発室IIIに引っ越す。IPアドレスなどの変更はなし。
	</ul>
<hr>
<a name="20020214">
2002年2月14日（木）
	<ul>
	<h4>DNSサーバ変更</h4>
	センターのシステム入れ替えに伴い、/etc/resolve/confのDNSサーバの設定を変更。
		<br>
		<div style="border:thin solid">
		chinatsu@nile[16]%  diff resolv.conf.old resolv.conf<br>
		3,4c3,4<br>
		< nameserver    133.51.168.11<br>
		< nameserver    133.51.168.12<br>
		---<br>
		> nameserver    133.51.16.242<br>
		> nameserver    133.51.20.242<br>
		7c7<br>
		< nameserver    133.51.60.5<br>
		---<br>
		> #nameserver   133.51.60.5<br>
		</div>
	</ul>
<hr>
<a name="20011128">
2001年11月28日（木）
	<ul>
	<h4>~g122移動準備</h4>
	/home の使用容量が95% になった。<br>
	ドクターの発表も近く、ファイル削除の作業などを<br>
	行えないタイミングなので、ファイル容量の多いg122(大懸さん)の<br>
	ホームディレクトリを /home/g122 から /project/g122 への移動<br>
	させておき、/home　の容量が100% に近くなったら /home/g122 を<br>
	削除できるようにしておく。<br>

	<pre>
	chinatsu@nile[123]% cd /project
	chinatsu@nile[124]% sudo mkdir g122
	Password:
	chinatsu@nile[125]% sudo chown g122 g122
	chinatsu@nile[126]% ls -l g122
	合計 0
	chinatsu@nile[127]% ls -ld g122
	drwxr-xr-x   2 g122     other        512 11月 28日  12:07 g122/
	chinatsu@nile[128]% sudo chgrp ulis g122
	chinatsu@nile[129]% ls -ld g122
	drwxr-xr-x   2 g122     ulis         512 11月 28日  12:07 g122/
	chinatsu@nile[130]% cd g122
	chinatsu@nile[131]% cd /home/g122
	chinatsu@nile[132]% su
	nile# sudo tar cf - . | (cd /project/g122;tar xpf -)
	</pre>
	
	suにならないとtar で移動できなかった。<br>
	ファイルサイズが/home/g122 と/project/g122 で異なるが、<br>
	これは、穴あきのバイナリデータがあるため。<br>
	</ul>
<hr>
<a name="20011125">
2001年11月25日（土）
	<ul>
	<h4>nile ディスクマウントせず</h4>
	nile のvfstab を書き換えてしまい、起動時に /, /var, /usr, /dev/fd のみ<br>
	マウントし、他のものはマウントしない状態になった。
	<a href="./011125.txt">作業などの覚書。</a>
	</ul>
<hr>
<a name="20011111">
2001年11月11日（日）
	<ul>
	<h4>Matlab Webserver</h4>
	<p>インストールと設定が終わったので、ドキュメントを/usr/local/matlab6p1/README_INSTALL_WEBSERVER に作成。詳しくはドキュメントを読んでください。主な変更点は以下のとおり。
		<ul>
			<li>Matlab Webserver のポート番号を27009とする。
			<li>Matlab Webserver 用にapache をインストール(/usr/local/apache_matlab)。
				ポート番号は8100。
			<li>Matlab 関連の起動ユーザ用にmatlab ユーザを作成。
		</ul>
	</ul>
<hr>
<a name="20010924">
<!-- 実際に作業したのは8月15日、でも、タイミングが合わなくて伸びました -->
2001年9月24日（月）
	<ul>
	<h4>メール関係の設定変更</h4>
		<p>
		今までは sendmail.cf で "From: username@ulis.ac.jp"としていたが、<br>
		問題がいくつか出てきたので、sendmail.cf では何もせず　 <br>
		"From: username@nile.ulis.ac.jp" となるように設定を変更。<br>
		<p>
		それに伴い、From行、Reply-to行などは各メーラで設定することとする。<br>
		
	<br>
	<li><b>sendmail.cfの設定変更</b><br>

		Anserbook2の"メールシステムの管理：新しい sendmail.cf ファイルを構築する方法"を
		参考に新しいsendmail.cfを作成。<br>
		<br>
		<div style="border:thin solid">
		# cp main-v7sun.mc test.mc<br>
		#  /usr/ccs/bin/make test.cf<br>
		/usr/bin/mv test.cf test.cf.prev<br>
		mv: test.cf を使用できません。<br>
		*** Error code 2 (ignored)<br>
		/usr/ccs/bin/m4 ../m4/cf.m4 test.mc > test.cf<br>
		#<br>
		</div>
		<br>
		エラーが出るが問題はないらしいので、test.cf の設定を変更する。
		変更は4点。diff の結果は<a href="./sendmail.log">ここ。</a><br>
		<br>
		<div style="border:thin solid">
		 Cwnile<br>

		 #Fw-o /etc/mail/sendmail.cw<br>
 		 
		 Dj$w.ulis.ac.jp<br>
 		 
		 DSsmtp.ipc.ulis.ac.jp<br>
		</div>
		<br>
		Fw-oのコメントアウトは怪しいが、問題がないのでOKとする。<br>
		
		test.cfを使ってテスト。
		<br>
		<div style="border:thin solid">
		# /usr/lib/sendmail -C /usr/lib/mail/cf/test.cf test@nile.ulis.ac.jp < /dev/null
		</div>
		<br>
		
		問題なさそうなので今までのsendmail.cf をsendmail.cf.mask とする。<br>
		test.cf を /etc/sendmail.cf にコピーし、sendmail を再起動。<br>
		<br>
		<div style="border:thin solid">
		# mv /etc/sendmail.cf /etc/sendmail.cf.mask
		# cp test.cf /etc/mail/sendmail.cf
		# pkill -HUP sendmail
		</div>
		<br>
	<li><b>mnewsの設定について</b><br>
		<ul>
		<li>From行の設定<br>
			mnewsでは、インストール時指定したドメイン名が、
			nile:/usr/local/lib/default-domain に<br>
			書かれている(nile はもちろんulis.ac.jpである）。<br>
			mnewsは、default-domainを見て、From行を決めているらしく、<br>
			設定変更なしで、" From: chinatsu@ulis.ac.jp (Chinatsu Ito)" となった。<br>
		<li>時刻表示について<br>
			mnews [version 1.22PL5] で、":Date: Wed, 15 Aug 2001 23:46:12 JST"となっており、<br>
			"+0900 (JST)"がないとの指摘を受ける。
			いくつかオプションを変えてみたが、変化なし。<br>
			version 1.22PL1までは "Date: Thu, 16 Aug 2001 01:21:00 +0900 (JST)"と<br>
			表示されていたのでバージョンのせいかもしれない（としておこう）。<br>
		</ul>
		<br>

	<li><b>fmlの設定変更</b><br>
		fmlで、Reply-to を	"@nile.ulis.ac.jp" とするために<br>
		/var/spool/ml/etc/fml/site_init.phを置いていたが、<br>
		sendmail.cfの変更により不要になったので、site_init.ph.old としておく。<br>
<hr>
<a name="20010924-2">
	<h4>7_Recommended patch エラー? (106950-14)</h4>
		<p>2001年9月13日付けの Solaris 7 Recommended Patch Clusterをあて、
		reboot したところ、以下のようなメッセージが5秒おきに出る。<br>
		<br>
		<div style="border:thin solid">
		Sep 24 13:12:42 nile cssd: starting kkcv.sh (pid#2694)<br>
		Sep 24 13:12:42 nile cssd: The process "ccv.sh" has been killed by sig#139, core dumped<br>
		Sep 24 13:12:47 nile cssd: starting ccv.sh (pid#2696)<br>
		Sep 24 13:12:47 nile cssd: The process "kkcv.sh" has been killed by sig#139, core dumped<br>
		</div>
		<br>
	
		<p> # file /core をしても、情報が得られないので、 #strings /core | less をしてみると<br>
			crt0: no /usr/lib/ld.so<br>
			/usr/ucblib<br>
		などの文字があるのでリンク関係がおかしいと判断し、怪しいものから削除してみる。
	
		<p>
		最初に、106950-14(Linker patch) を　 #patchrm するとエラーが消えたので、
		とりあえず、様子を見ることにする。

	</ul>
<hr>
<a name="20010822">
2001年8月22日（水）
<ul><h4>MATLAB6のインストール</h4>
	<A href="http://nile/nile/installer/softlist.shtml#MATLAB.2001-08-22">
	インストール記録。</a><br>
	同時にMATLAB Web Server を設定しようとしたが、
	エラーが出てうまくいかない。<a href="#20011111"> 後日行う。</a>
</ul>
<!--
<hr>
2001年8月15日（水）
/project3 をmount して利用開始。
-->
<hr>
<a name="20010624">
2001年6月24日（日）
	<ul><h4>DDS4 Autoloader の設置</h4>
		<p>
		本体をSCSI につないで、boot -r。
		SCSIアドレスを4に設定。/dev/rmt/1 で利用可能。
	</ul>
<hr>
<a name="20010622">
2001年6月22日（金）
	<ul><h4>sendamilパッチ（107684-02)バク？</h4>
	<p>
	6月19日付けの Solaris 7 Recommended Patch Clusterを
	あてたところ、nile からメールが送信できず。<br>
	どうも、sendmailのパッチ(107684-02)によって sendmail.cfが
	変更されたのが原因のよう。<br>
	107684-02 を削除して、107684-01 にパッチレベルを戻して、
	再起動したところメールの送信は可能となる。<br>

	nile は sendmail.cf の設定をいくつか変更しているので、
	それをきちんと標準（？）に戻してやればパッチがあたるかも。
	</ul>
<hr>
<a name="20010613">
2001年6月13日（火）
	<ul><h4>fml,Python,kconvのインストール</h4>
	<li><b> fml をインストール。</b><br>
	使い方は<a href="../fml_readme.html">fml の使い方</a>にあり。<br>
	root の作業も必要なので、同じファイル内にメモ。
	インストール時の注意点、メモなどは<a href="./fml.log">ここ</a>にあり。<br>
	<br>

	<li><b>Python-2.1 のインストール</b><br>
		挫折した用途のためにインストール。<br>
		ソース: http://www.python.org/<br>
		参考URL: http://www.zob.ne.jp/~hide-t/comp/python/<br>
		インストール先：/usr/local/lib/python2.1<br>
						/usr/local/bin/python2.1<br>
						/usr/local/bin/python<br>
		ログとり忘れましたが、特別な設定はしてません。<br>
		<br>

	<li><b>kconv-1.1.7 のインストール</b><br>
		Pythonの日本語文字コード変換モジュール<br>
		ソース：http://www.eccosys.co.jp/~mak/kconv/index_jp.html<br>
				kconv-1.1.7p.tar.gz<br>
		c++ 版はエラーが出てmake できないので python版にしました。<br>
		p版の方が遅いので必要ならば c++版にした方がいいかも。<br>
	
		%python compile.py optimize<br>
		% cd kconv<br>
		%sudo cp -R kconv /usr/local/lib/python2.1/site-packages/
	</ul>
<hr>
<a name="20010531">
2001年5月31日（木）
	<ul><h4>www-student設定</h4>
	高久くんがwww-student の設定を行ってくれた。
	センターへの提出書類は黄色いファイルにあり。<br>
	<br>
	<div style="border:thin solid">
	たかくです。<br>

	先ほど、nile で<br>
	学生サーバを立ち上げるのに必要な設定の変更および<br>
	センターへの書類の提出を行いました。<br>
	
	設定内容は、<br>
	<ul>
	<li>/etc/hosts の修正<br>
        	ホスト名別名 www-student の追加。<br>
	<li>/usr/local/apache/conf/httpd.conf の修正<br>
        	バーチャルホスト設定の追加<br>
	<li>メンバ（k248,j133）のユーザ登録<br>
	</ul>
	です。<br>
	<br>
	ディスクスペースとしては、とりあえず /project/www-student<br>
	を割り当てています。<br>
	</div>
	</ul>
	
<hr>
<a name="20010528">
2001年5月28日（月）
<ul><li><h4>www-studentについて</h4>
	<ul>
	cosmo 故障につき、www-studentを cosmo 復旧までの間、nile に移行することが決定。
	実作業は高久くんが行う。
	</ul>
	<!--DDS4 オートローダを宇陀先生のところからもらってくる -->
	</ul>
<hr>
<a name="20010527">
2001年5月27日（日）
<ul><li><h4>sshd の変更</h4>
	<ul>
	<p>
	ssh でログインするとメールが来ていても "No mail" とメッセージがでるとの指摘あり。
	原因は、sshd が MAIL 環境変数の設定をミスっていることのようです。

	<p>
	<div style="border:thin solid">
	masao writes:<br>
	　<br>
	　sshd はコンパイル時にシステムの　<br>
	　メールスプールを決定するのですが、これを探す順序が　<br>
    	　　/var/spool/mail /var/mail /usr/spool/mail /usr/mail　<br>
	　となっており、運の悪いこと(?)になぜか nile には　<br>
	　スプールには関係のない /var/spool/mail ディレクトリが実在するため、　<br>
	　こちらをデフォルトのメールスプールとしてしまうようです。　<br>
	</div>

	<p>
	そこで、configure:6120行目
	<div style="border:thin solid">
	 for dir in /var/spool/mail /var/mail /usr/spool/mail /usr/mail FILE
	</div>

	を
	<div style="border:thin solid">
	for dir in /var/mail /var/spool/mail /usr/spool/mail /usr/mail FILE
	</div>
	と探索順を変更。改めて、make しインストール、sshd を再起動する。

	<p>
	sshd が/var/mail をチェックするようになると、
	<p>
	<div style="border:thin solid">
	chinatsu@dream[4]% slogin nile<br>
	chinatsu@nile's password: <br>
	Last login: Sun May 27 19:52:42 2001 from dream<br>
	You have new mail.<br>
	Sun Microsystems Inc.   SunOS 5.7       Generic October 1998<br>
	You have new mail.<br>
	</div>
	<p>
	とメールのチェックが2回されるようになったので、
	/etc/sshd_config の PrintMotd および CheckMail を
	<p>
	<div style="border:thin solid">
	PrintMotd no<br>
	CheckMail no
	</div>
	に変更、sshdを再起動する。
	</ul>
</ul>

	
<hr>
<a name="20010525">
2001年5月25日（金）
<ul>
<li><h4>二次ディスク(project3:34GB) 接続</h4>
	<p>
	ディスクの接続は 「オンラインマニュアルSolarisのシステム管理(第1巻）
	ディスクの管理 第23章 SPARC: ディスク追加の手順 」を参考にして行う
	（コピーは黄色のファイルに保存）。ディスクスライス、ラベル、
	ファイルシステムの作成は
	「Solarisシステム管理入門 2nd Edition 3.4 ディスクの管理(p.121- )」
	も参考にする。
	ディスクの命名規則は、Solarisシステム管理入門が分かりやすい。
	</p>
	<ul>
	<li><b>ディスクの取り付け</b>
		<p>
		<ul>
		root になる。<br>
		<br>
		<div style="border:thin solid">
		# touch /reconfigure<br>
		# /usr/sbin/shutdown -i0 -g0 -y
		</div><br>
		電源を切り、コンセントを抜く。<br>
		取り付けはnile の本体のところに置いてある説明書の手順で行う。<br>
		取り付け完了後、boot	
		</ul>
		</p>

	<li><b>ディスクスライス、ラベルの作成 </b>　<a href="./project3.log">ログファイル</a>
	 	<ol><br>
		<li>root になってフォーマット開始。
		<div style="border:thin solid">
		root@nile[3]% format<br>
		</div><br>

		<li> 表示されたリストの中からフォーマットしたいディスクの番号を入力。
		<div style="border:thin solid">
		Specify disk (enter its number): 6<br>
		</div> <br>

		<p>
		<li>
		パーティションメニューへ
		<div style="border:thin solid">
		format> partition<br>
		</div>
		</p>
		
		<p>
		<li>パーティションテーブルを表示。<br>
		<div style="border:thin solid">
		partition> print<br>
		</div>
		</p>

		<p>
		<li> 変更作業開始。
		<div style="border:thin solid">
		partition> modify<br>
		</div>
		</p>

		<p>
		<li>Free Hog を選択
		<div style="border:thin solid">
		Select partitioning base:<br>
			0. Current partition table (original)<br>
			1. All Free Hog<br>
		Choose base (enter number) [0]? 1<br>
		</div>
		
		<p>
		<li>続行を選択し、スライスを設定。<br>
			スライス番号は 「Solarisシステム管理入門 2nd Edition p.125」参照のこと
		<div style="border:thin solid">
		Do you wish to continue creating a new partition<br>
		table based on above table[yes]? y<br>
		Free Hog partition[6]? 7<br>
		</div>
		
		<p>
		<li>表示されたパーティションを選択し、パーティションのテーブルに
		名前つける。名前は""で囲んで入力<br>
		<div style="border:thin solid">
		Okay to make this the current partition table[yes]? y<br>
		Enter table name (remember quotes): "project3"<br>
		</div>
		</p>

		<p>
		<li>パーティションメニューをぬけ、ディスクラベルを確認。その後フォーマットを終了する。
		<div style="border:thin solid">
		Ready to label disk, continue? y<br>
		partition> q<br>
		format> verify<br>
		format> q<br>
		</div>
		</ul><br>
		
		<p>
		<li><b>ファイルシステムの作成</b>
	 	<ul><br>
		<div style="border:thin solid">
		root@nile[10]% newfs /dev/rdsk/c0t12d0s7
		</div>
		</ul><br>
		ディスク命名規則は 「Solarisシステム管理入門 2nd Edition p.121」参照のこと

		<p>
		<li><b>マウント</b>
	 	<ul><br>
		<div style="border:thin solid">
		root@nile[11]% mkdir /project3<br>
		root@nile[12]% mount /dev/dsk/c0t12d0s7 /project3
		root@nile[13]% mount -p > /etc/vfstab
		</div>
		</ul><br>

		</ul>
</ul>
<!-- 5月24日 DDS4 のオートローダー到着 -->	
<hr>
<a name="20010427">
2001年4月27日（金）
	<ul><h4>mnews1.22PL5インストール</h4><br>
	mnews1.21PL5を1.22PL5にバージョンアップ <a href="./mnews122.log">ログ</a><br>
	<br>
	<b>変更点</b><br>
	<ul>
	<li>アーキテクチャ番号:13<br>
			<ul>
			13.SVR4   for other System-V Release4.<br>
              NEC EWS4800(EWS UX/V Rel4.X), UP4800(UP-UX/V)<br>
              OKIstation, SUN SUN-OS 5.X(Solaris 2.X)...<br>
			</ul>
	<li>JPEG ビューアーとオプション(デフォルト:xv): display<br>
	<br>
	<li>GIF ビューアーとオプション(デフォルト:xv): display<br>
	<br>
	<li>コンフィグレーションオプション:<br>
	-DCTRL_L -DCOMPLETION -DREF_SORT -DLARGE -DDISPLAY_CTRL -DBUILTIN_MMH -DCOLOR<br>
	<br>
	<li>ドメイン名: ulis.ac.jp<br>
	<br>
	<li>印刷コマンドとオプション(デフォルト:lpr): lp<br>
	<br>
	<li>コンパイラ(デフォルト:/bin/cc): /opt/SUNWspro/bin/cc<br>
	</ul>
	</br>

	</ul>

<hr>
<a name="20010414">
2001年4月14日（土）
	<ul><h4>UPS交換</h4>
	UPS本体を交換する。nile とUPS 間をつなぐRC232C のケーブルは以前のUPS に<br>
	付属していたものを利用。UPS の電源を抜き、停電のテストをする。復電しても <br>
	nile が起動しないことを確認。<br>
	</ul>
<hr>
<a name="20010412">
2001年4月12日（木）
<ul>
<li><h4>UPS管理ソフト、PowerVisor をver.2 からVer.3 にバージョンアップ</h4><br>
	<ol>
	<p>
	<li><b>rootになって、以前のバージョンをアンインストール</b>
	<div style="border:thin solid">
	# /usr/local/ups/bin/CLEANUP
	</div>
	そのままCLEANUP を実行すると /etc/syslog が変更されるので、実行前に
	スクリプトを確認する必要がある。

	<p>
	<li><b>Ver.3 のインストール。</b>
	<p>
	XINSTALL(xinst)でインストールするより、cinst でインストールおよび設定変更を
	するほうが確実である(XINSTALL だと設定できてない部分があった）。
	<p>
	設定は /usr/local/ups/lib/upstab にあり。
	<div style="border:thin solid">
		ttyname: /dev/ttyb<br>
		upslog: /var/adm/upslog<br>
		autoreboot: off<br>
	</div>
	の設定がデフォルトとは異なっている。<br>
	autoreboot をoff にしておかないと復電時に起動してしまうので注意。

	<p>
	upsのオンライン版のマニュアルは<a href="./ups_manual/index.htm">ここ（UNIX版のみ）</a>。
	</ol>
</ul>
<hr>
<a name="20010406">
2001年4月6日（金）
	<ul><h4>IPアドレス、ネットマスク、ゲートウェイの変更</h4>
<pre>
	ギガビット導入によりnile のIPアドレス、ネットマスク、ゲートウェイを変更する。
	学内のほぼ全てのホスト、プリンタなどがIPアドレス変更となるので、適宜変更する。

	下準備）
	sendmailを止める
	# /etc/init.d/sendmail stop

	nile をシングルユーザモードにする。
	# /usr/sbin/shutdown -y -g0 -i0
	# init s
	
	作業）
	・変更サブネットマスク255.255.252.0 から 255.255.255.0 に変更
	/etc/netmask
	# Both the network-number and the netmasks are specified in
	# "decimal dot" notation, e.g:
	#
	#               128.32.0.0 255.255.255.0
	#
	133.51.0.0      255.255.255.0

</pre>
	<li><b>ホストのIP アドレスを変更</b>
<pre>
	/etc/hosts
	nile のところを 133.51.14.8 に変更
	
	他のホスト、プリンタなどはコメントアウトしておき、安定して稼動したら
	設定する。
</pre>

	<li><b>デフォルトルータの設定</b>
<pre>
	/etc/defaultrouter を作成。
	ゲートウェイアドレスのアドレス 133.51.14.254 とだけ記述。
		
		今回の変更で /etc/defaultrouter なしでは サブネットが14 以外のホストと
		接続できなかったため作成。
	
	# init 6 または boot
	リブート後、ifconfig -a で確認。

</pre>
	</ul>
<hr>
<a name="20010331">
2001年3月31日（土）
	<ul><h4>snmpXdmid</h4>
	CERT のAdvisory により Soralis7 のsnmpXdmid はオーバーフローが置き、<br>
	root 権限が取られるとわかる。Sun でパッチがでていないので、Advisory に<br>
	書いてある対処法を実施。<br>
	<br>
	<div style="border:thin solid">
	chinatsu@nile[1]% ls -l ./rc*?.d/* |grep dmi<br>
	-rwxr--r--   6 root     sys          861  9月  1日 1998年 ./rc0.d/K07dmi*<br>
	-rwxr--r--   6 root     sys          861  9月  1日 1998年 ./rc1.d/K07dmi*<br>
	-rwxr--r--   6 root     sys          861  9月  1日 1998年 ./rc2.d/K07dmi*<br>
	-rwxr--r--   6 root     sys          861  9月  1日 1998年 ./rc3.d/S77dmi*<br>
	-rwxr--r--   6 root     sys          861  9月  1日 1998年 ./rcS.d/K07dmi*<br>
	chinatsu@nile[3]% sudo mv /etc/rc3.d/S77dmi /etc/rc3.d/K77dmi<br>
	Password:<br>
	chinatsu@nile[6]% sudo /etc/init.d/init.dmi stop<br>
	chinatsu@nile[7]% ps -aef |grep dmi<br>
	chinatsu 17670 17628  0 17:02:54 pts/7    0:00 grep dmi<br>
	chinatsu@nile[8]% ls -l /usr/lib/dmi/snmpXdmid<br>
	-rwxr-xr-x   1 root     sys       213096 11月  3日  15:07 /usr/lib/dmi/snmpXdmid*<br>
	chinatsu@nile[11]% sudo chmod 000 /usr/lib/dmi/snmpXdmid<br>
	chinatsu@nile[12]% ls -l /usr/lib/dmi/snmpXdmid<br>
	----------   1 root     sys       213096 11月  3日  15:07 /usr/lib/dmi/snmpXdmid<br>
	</div>
	<br>
	</ul>
<!-- 20010322 nile のUPS を宇陀先生の部屋からもらってくる -->
<hr>
<a name="20001217">
2000年12月17日（日）
	<ul><h4>/etc/shadowの変更</h4>
	/etc/shadow の中にあった NP をLK にする。<br>
	今回 LK に変更したものは以下のものである。<br>
	daemon, bin, sys, adm, lp, uucp, nuucp, listen, nobody
	noaccess, totalnet, nobody4, 
	</ul>
<hr>
<a name="20001215">
2000年12月15日（金）
	<ul><h4>Solaris 7 Recommended Patch Cluste</h4>
	Solaris 7 Recommended Patch Cluster (Nov/02/00) をあてる。<br>
	ログは nile:/var/sadm/install_data/Solaris_7_Recommended_log  にあり。
	</ul>
<hr>
<a name="20001218">
2000年12月8日（金）
	<ul><h4>tcp_wrapper インストール</h4>
	/etc/inet/inetd.conf を書き換える。<br>
	が、sshd をtcp_wrapper 対応にしなければいけないので、
	もとにもどして、設定をべつにする。
	</ul>
<hr>
<a name="20001004">
2000年10月4日(水）
	<ul><h4>*/man/windex 更新</h4>
	<br>
	<div style="border:thin solid">
	nile# setenv LANG ja<br>
	nile# catman -w <br>
	nile# setenv LANG C<br>
	nile# catman -w <br>
	</div>
	<br>

	catman -w  を行う時には MANPATHに windex を作成したい manのディレクトリを指定する。<br>
	言語が ja の時は */man/ja のwindex が、C の時は */man のwindex が作成される。
	</ul>
<hr>
<a name="20000925">
2000年9月25日（月）
	<ul><h4>特別接続開始,パスワードのエージング開始（syslog,inetd.conf変更)</h4>
		<ol>
      	<li><b>nile 特別接続開始。</b><br>
		<br>

      	<li><b>パスワードのエージング開始。</b><br>
			<ul>
			<li>/etc/default/passwd の設定変更<br>
			これにより passwd をすると設定された値が適応される。<br>
	
			<br>
			<div style="border:thin solid">
			<pre>
			diff passwd.org passwd
			2,3c2,1	2
			< MAXWEEKS=
			< MINWEEKS=
			---
			> #
			> # 特別接続するにあたり、パスワードのエジングをかける。
			> # 2000.09.25 より実施
			> # MAXWEEKS  パスワードが有効な最大期間
			> # MINWEEKS  パスワード変更に最低限必要な期間
			> # WARNWEEKS パスワードの有効期間が切れる前の警告期間
			> # PASSLENGTH パスワードに最低限必要な文字数
			> #
			> MAXWEEKS=17
			> MINWEEKS=2
			> WARNWEEKS=4
			</pre>
			</div>
			<br>
	
			<li>現行ユーザのパスワードの有効期間変更<br>
			<br>
			<div style="border:thin solid">
	  		nile#	passwd -n 14 -w 28 -x 119 ユーザ名<br>
	  			-n: Min の設定（日数）<br>
	  			-w: Warn の設定（日数）<br>
	  			-x: Max の設定（日数）<br>
			</div>
			</br>
			　により変更。
			</ul><br>
	
		<li><b>syslog.conf変更</b><br>
		特別接続をするにあたり、nile のログをいままでより細かくとれるように
		syslog.confを書き換える。<br>
		
		<br>
		<div style="border:thin solid">
		<pre>
		chinatsu@nile[29]% diff syslog.conf.org syslog.conf
		12c12,14
			< *.err;kern.debug;daemon.notice;mail.crit      /var/adm/messages
		---
		> *.err;kern.debug;daemon.notice;daemon.debug;mail.crit /var/adm/messages
		> daemon.notice;daemon.debug;                           /var/log/syslog
		> #*.err;kern.debug;daemon.notice;mail.crit     /var/adm/messages
		18a21,28
		> # sshd SyslogFacility code is LOCAL3
		> local3.debug                          /var/adm/messages
		> local3.debug                          /var/log/syslog
		> 
		37,41c47,51
		< daemon.notice                 /dev/sysmsg
		< daemon.notice                 /nsr/logs/messages
		< daemon.notice                 operator
		< local0.notice                 /nsr/logs/summary
		< local0.alert                  root, operator
		---
		> #daemon.notice                        /dev/sysmsg
		> #daemon.notice                        /nsr/logs/messages
		> #daemon.notice                        operator
		> #local0.notice                        /nsr/logs/summary
		> #local0.alert                 root, operator
		</pre>
		</div>
		<br>
	
		<li><b>inetd.conf変更</b><br>
		<br>
		<div style="border:thin solid">
		<pre>
		diff inetd.conf.org inetd.conf
		19c19
		< ftp   stream  tcp     nowait  root    /usr/sbin/in.ftpd       in.ftpd
		---
		> ftp   stream  tcp     nowait  root    /usr/sbin/in.ftpd       in.ftpd -l
		30c30
		< exec  stream  tcp     nowait  root    /usr/sbin/in.rexecd     in.rexecd
		---
		> #exec stream  tcp     nowait  root    /usr/sbin/in.rexecd     in.rexecd
		36c36
		< uucp  stream  tcp     nowait  root    /usr/sbin/in.uucpd      in.uucpd
		---
		> #uucp stream  tcp     nowait  root    /usr/sbin/in.uucpd      in.uucpd
		58,65c58,65
		< echo  stream  tcp     nowait  root    internal
		< echo  dgram   udp     wait    root    internal
		< discard       stream  tcp     nowait  root    internal
		< discard       dgram   udp     wait    root    internal
		< daytime       stream  tcp     nowait  root    internal
		< daytime       dgram   udp     wait    root    internal
		< chargen       stream  tcp     nowait  root    internal
		< chargen       dgram   udp     wait    root    internal
		---
		> #echo stream  tcp     nowait  root    internal
		> #echo dgram   udp     wait    root    internal
		> #discard      stream  tcp     nowait  root    internal
		> #discard      dgram   udp     wait    root    internal
		> #daytime      stream  tcp     nowait  root    internal
		> #daytime      dgram   udp     wait    root    internal
		> #chargen      stream  tcp     nowait  root    internal
		> #chargen      dgram   udp     wait    root    internal
		93c93
		< rusersd/2-3   tli     rpc/datagram_v,circuit_v       
	  	wait root /usr/lib/netsvc/rusers/rpc.rusersd    rpc.rusersd
		---
		> #rusersd/2-3  tli     rpc/datagram_v,circuit_v        
	  	wait root /usr/lib/netsvc/rusers/rpc.rusersd    rpc.rusersd
		97c97
		< sprayd/1      tli     rpc/datagram_v  
	   	wait root /usr/lib/netsvc/spray/rpc.sprayd      rpc.sprayd
		---
		> #sprayd/1     tli     rpc/datagram_v  
	   	wait root /usr/lib/netsvc/spray/rpc.sprayd      rpc.sprayd
		101c101
		< walld/1               tli     rpc/datagram_v  
	  	wait root /usr/lib/netsvc/rwall/rpc.rwalld      rpc.rwalld
		---
		> #walld/1              tli     rpc/datagram_v  
	  	wait root /usr/lib/netsvc/rwall/rpc.rwalld      rpc.rwalld
		</pre>
		</div>
		</ol>
	</ul>

<hr>
<a name="20000821">
2000年8月21日（月）
	<ul>
	1) パッチ当て日。作業終了後 reboot 。<br>
	2) / の下にあった error_log 削除。
	</ul>
<hr>
<a name="20000715">
2000年 7月15日（土）
	<ul><h4>ディスプレイ交換</h4>
        seine ハードディスクを認識しなくなり、活動停止。<br>
        そこで、seine のグラフィックカードをnile に移植し、seine のディスプレイを<br>
        nile で使うこととする。借りていたJ3100 は返却。<br>
        
		<p>
		<b>手順</b>
		<ol>
		<li> nile 電源停止。
        <li> 裏側向かって右から2番目のスロットを抜く。
        <li> seine から抜いたグラフィックカードを指定の場所にさす。
        <li> 本体にスロットを戻す。
        <li> 再起動 (boot -r) <br>
                -r は新規にデバイスを接続した時に使用。<br>
                システムのコンフィギュレーションを自動的に行ってくれる。<br>
                デバイスの増設・取り外し時に1度行えばよい。<br>
                → see solaris2.5.1 システム管理入門 p.51<br>
		</ol>
	</ul>

<hr>
<a name="20000610">
2000年6月10日(土)
	<ul><h4>apache設定</h4>
        apacheの設定終了。<br>
        今まで動いていたSun WebServer は停止させ、apache をポート80で動かす 。  <br>

        /usr/local/apache/conf のhttpd.conf　を編集。<br>
        cosmo のhttpd.conf を参考にする。<br>

	<br>
	<div style="border:thin solid">
	<pre>
        chinatsu@nile[10]%diff httpd.conf.default httpd.conf
        238c238,239
        < Port 8080
        ---
        > #Port 8080
        > Port 80
        315c316,317
        <     Options Indexes FollowSymLinks MultiViews
        ---
        >     #Options Indexes FollowSymLinks MultiViews
        >     Options MultiViews All
        322c324,325
        <     AllowOverride None
        ---
        >     #AllowOverride None
        >     AllowOverride All
        343c346
        < #<Directory /home/*/public_html>
        ---
        > <Directory /home/*/public_html>
        345,354c348,358
        < #    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
        < #    <Limit GET POST OPTIONS PROPFIND>
        < #        Order allow,deny
        < #        Allow from all
        < #    </Limit>
        < #    <LimitExcept GET POST OPTIONS PROPFIND>
        < #        Order deny,allow
        < #        Deny from all
        < #    </LimitExcept>
        < #</Directory>
        ---
        >     AllowOverride All
        >     Options MultiViews All
        >     <Limit GET POST OPTIONS PROPFIND>
        >         Order allow,deny
        >         Allow from all
        >     </Limit>
        >     <LimitExcept GET POST OPTIONS PROPFIND>
        >         Order deny,allow
        >         Deny from all
        >     </LimitExcept>
        > </Directory>
        361c365,366
        <     DirectoryIndex index.html
        ---
        >     #DirectoryIndex index.html
        >     DirectoryIndex index.html index.shtml
        493a499
        > #CustomLog /usr/local/apache/logs/access_log combined
        705c711,712
        <         LanguagePriority en da nl et fr de el it ja pl pt pt-br ltz ca es sv
        ---
        >         #LanguagePriority en da nl et fr de el it ja pl pt pt-br ltz ca es sv
        >         LanguagePriority ja en da nl et fr de el it pl pt pt-br ltz ca es sv
        735c742
        <     #AddHandler cgi-script .cgi
        ---
        >     AddHandler cgi-script .cgi
        740,741c747,748
        <     #AddType text/html .shtml
        <     #AddHandler server-parsed .shtml
        ---
        >     AddType text/html .shtml
        >     AddHandler server-parsed .shtml
	</pre>
	</div>
	</ul>

<hr>
<a name="20000604">
2000年6月4日(日)
	<ul><h4>apacheインストール</h4>
	nile のWeb サーバ(Sun Web Server) の設定がおかしいことに気づいたが、直すのが<br>
	難しそうなので、Apache(1.3.12) をインストールした。<br>
	port 番号は8080 とする。<br>
	<br>

	<li><b>apache のインストール</b><br>
		http://japache.infoscience.co.jp/apache/dist/　から<br>
        apache_1.3.12.tar.gzをダウンロード
		<ol>
        <li> 解凍<br>
		<br>
		<div style="border:thin solid">
		chinatsu@nile[8]% gunzip apache_1.3.12.tar.gz |tar xvf<br>
		chinatsu@nile[9]% tar xvf apache_1.3.12.tar<br>
       	chinatsu@nile[38]% ./configure --prefix=/usr/local/apache<br>
		</div>
		<br>
        <li>コンパイル<br>
		<br>
		<div style="border:thin solid">
       	chinatsu@nile[39]% make<br>
		</div>
		<br>

        <li>インストール<br>
		<br>
		<div style="border:thin solid">
        chinatsu@nile[1]% su<br>
        Password:<br>
        # csh<br>
        nile# pwd<br>
        /home/chinatsu/src/apache_1.3.12<br>
        nile# make install<br>
		</div>
		<br>

        <li>設定<br>
        /usr/local/apache/conf のhttpd.conf　を編集 <br>
		</ol>
	</ul>
<hr>
<a name="20000514">
2000年5月14日(日)
	<ul><h4>nile の掃除</h4>
        一分ほどの停電あり。雷雨のためらしい。nile をシャットダウンする。<br>
        ついでに、nile の掃除をする。ファンのところはほとんど汚れていなかったが、<br>
        cpuボードには結構埃がたまっていた。1年に一度は掃除をしたほうがよさそうだ。
	</ul>
<hr>
<a name="20000509">
2000年5月9日(火)
	<ul><h4>CPU とメモリのチェック</h4>
        SunVTS というシステム診断のためのソフトウェアでCPU とメモリのチェックをしてみる。<br>
        特に異状はないようだ。<br>
        阪口先生曰く「送風口などに埃がたまっているのはないか」とのこと。
        折をみて掃除をすることにする。
	</ul>
<hr>
<a name="20000508">
2000年5月8日(月)
	<ul><h4>ハードエラー発生</h4>
        22時半ごろ /var/adm/message を見ると、2000/5/5 よりエラーが出ていることに気づく。<br>
        ＃前に見たのは 5月4日だと思う。<br>

	<br>
	<div style="border:thin solid">
		<pre>
        May  3 00:07:40 nile root: Solstice Backup Registration: 
        (info) License enabler #none (NetWorker/10 Eval) has expired.
        May  4 00:06:32 nile root: Solstice Backup Registration: 
        (info) License enabler #none (NetWorker/10 Eval) has expired.
        May  5 00:01:06 nile root: Solstice Backup Registration: 
        (info) License enabler #none (NetWorker/10 Eval) has expired.
        ------------------↓ここからエラーが出始める-----------------
        May  5 00:49:16 nile unix: Multiple Softerrors: 
        May  5 00:49:16 nile unix: 0 Intermittent and 6 Corrected Softerrors accumulated 
        May  5 00:49:16 nile unix: from Memory Module Board 3 J3501
        May  5 00:49:16 nile unix:      Enabling verbose CE messages.
        May  5 00:49:16 nile unix: Softerror: Persistent ECC Memory Error
        May  5 00:49:16 nile unix:  Corrected MemMod Board 3 J3501
        May  5 00:49:16 nile unix:      ECC Data Bit 27 was corrected
        May  5 00:49:46 nile unix: CPU7 CE Error: 
                AFSR 0x00000000.00100000 AFAR 0x00000000.1cc3ee78 UDBL MemMod Board 3 J3501
        May  5 00:49:46 nile unix:      Syndrome 0x54 Size 3 Offset 0 UPA MID 7
        May  5 00:49:46 nile unix: Softerror: Persistent ECC Memory Error
        May  5 00:49:46 nile unix:  Corrected MemMod Board 3 J3501
        May  5 00:49:46 nile unix:      ECC Data Bit 27 was corrected
        May  5 00:50:16 nile unix: CPU7 CE Error: 
                AFSR 0x00000000.00100000 AFAR 0x00000000.1cc3ee78 UDBL MemMod Board 3 J3501
        
        と30秒おきに続き

        May  8 16:53:11 nile unix: CPU7 CE Error: 
                AFSR 0x00000000.00100000 AFAR 0x00000000.1cc3ee78 UDBL MemMod Board 3 J3501
        May  8 16:53:11 nile unix:      Syndrome 0x54 Size 3 Offset 0 UPA MID 7
        May  8 16:53:11 nile unix: Softerror: Persistent ECC Memory Error
        May  8 16:53:11 nile unix:  Corrected MemMod Board 3 J3501
        May  8 16:53:11 nile unix:      ECC Data Bit 27 was corrected
        8日の16:53:11 のメッセージを境に消える。
	</pre>
	</div>
	<br>

        どうも、ハードのエラー（CPU or メモリ）のようです。<br>
        順番が逆かもしれないが、とりあえず、/home, /project  のバックアップをとることにする。<br>
        必要なバックアップがどれてから、システムのチェックをする。<br>
	</ul>
<hr>
<a name="20000504">
2000年5月4日（木)
		<ul><h4>nakata-nx削除</h4>
        nakata-nxを削除。
		</ul>
<hr>
<a name="20000324">
2000年3月24日（金)
		<ul><h4>使用延長のおしらせ</h4>
        今年卒業予定の人にアカウントをどうするかをメールで聞く。
        延長して欲しいという人が2名。あとは延長しなくてもよいのだろう。
		</ul>
<hr>
<a name="20000323">
2000年3月23日（木)
	<ul><h4>UPS覚書、コンソール取替え</h4>
		<li><b>UPSメモ</b><br>
        UPS がそろそろ寿命とのこと(平成10年7月から使用）。<br>
        製造元のGSEE社のホームページ(http://www.gsee.co.jp) で同機種の価格などを見たので覚書。<br>
        
		<pre>
        PICO2-1200
        バッテリー交換(２年〜６年)　59,000円
        本体                            194,000円
                （本体は6年ぐらいで交換するのが望ましいそうだ）
                日眞電器(http://www.nisshindenki.co.jp/) では14万円ぐらいでした。
		</pre>
		<li><b>nile のコンソールを取り替える</b><br>
        nile のコンソールを変更する。ラップトップは阪口先生から借りたもの。<br>
		チェーンは宇陀先生から借用。<br>
        ラップトップのふたを閉めておくと、ディスプレイの電源はoff になりますが、<br>
        本体は動いています。普段は、閉めたままにしておくほうが良いと思います。<br>
	</ul>
<hr>
<a name="19991205">
1999年12月5日（日）
	<ul><h4>makeuser変更</h4>
        makeuser の NIS に関係するものを消して、nileのみのユーザ登録用に書き換える。<br>
        NIS 用のmakeuser は makeuser.nis として保存。<br>
        また、ユーザへのメッセージ、管理者へのメッセージも一部書き換える。<br>
	</ul>
<hr>
<a href="../admin.html">nile 管理者用ページ</a><br>
<html>
